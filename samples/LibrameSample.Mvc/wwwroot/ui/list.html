<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8" />
    <title>博客列表测试</title>
    <link href="../lib/kendo/css/kendo.common.min.css" rel="stylesheet" />
    <link href="../lib/kendo/css/kendo.default.min.css" rel="stylesheet" />
    <script src="../lib/jquery/js/jquery.min.js"></script>
    <script src="../lib/angular/js/angular.min.js"></script>
    <script src="../lib/kendo/js/kendo.all.min.js"></script>
</head>
<body>
    <h3 style="font-family:Verdana;">Librame v5.0.2</h3>
    <h4 style="font-family:Verdana;">Support ASP.NET vNext (MVC 6 + EntityFramework 7 + Kendo UI)</h4>
    <div id="grid"></div>

    <script>
        $(document).ready(function () {
            var baseUrl = "/Blog";
            $("#grid").kendoGrid({
                dataSource: {
                    type: "json",
                    transport: {
                        read: {
                            url: baseUrl,
                            type: "GET"
                        },
                        update: {
                            url: baseUrl + "/Update",
                            type: "POST"
                        },
                        destroy: {
                            url: baseUrl + "/Delete",
                            type: "POST"
                        },
                        create: {
                            url: baseUrl + "/Create",
                            type: "POST"
                        },
                        parameterMap: function (options, operation) {
                            if (operation == "read") {
                                return {
                                    take: options.take,
                                    skip: options.skip,
                                    filter: options.filter
                                }
                            } else if (operation !== "read") {
                                // 不知为何 options 变成了 models？
                                return {
                                    models: kendo.stringify(options)
                                };
                            }
                        }
                    },
                    schema: {
                        model: {
                            id: "Id",
                            fields: {
                                Id: { editable: false, defaultValue: 0 },
                                Title: { type: "string", validation: { required: true } },
                                Description: { type: "string" },
                                Pubdate: { type: "date" }
                            }
                        },
                        // 支持 IPageable 可分页列表
                        data: function (json) {
                            if (json.rows) {
                                return json.rows;
                            } else {
                                return json;
                            }
                        },
                        total: function (json) {
                            if (json.total) {
                                return json.total;
                            } else {
                                return json.length;
                            }
                        }
                    },
                    pageSize: 2,
                    serverPaging: true,
                    serverFiltering: true,
                    serverSorting: true
                },
                toolbar: [
                    { name: "create", text: "新增记录" },
                    { name: "save", text: "保存修改" },
                    { name: "cancel", text: "取消修改" }
                ],
                editable: true,
                filterable: true,
                sortable: true,
                pageable: true,
                columns: [
                    { field: "Title", filterable: true },
                    { field: "Description", filterable: true },
                    { field: "Pubdate", format: "{0:MM/dd/yyyy}" },
                    {
                        command: [
                            { name: "destroy", text: "删除" }
                        ],
                        title: "&nbsp;", width: "250px"
                    }
                ]
            });
        });
    </script>
</body>
</html>